# 类型说明文件

CMS 被设计为一种通用的高层中间表示，这要求其具有能表述常见类型的能力。

## 格式

我们假设一种基于32位平台的C语言实现，它的类型大小如下：

类型|大小（字节）
--|--
int|4
long int|4
long long int|8

我们提供一个包含如下函数的静态库，用于支持各种类型的操作：
（注：这段代码可以手写，也可以使用程序生成。）

```c
typedef long int lint;
typedef long long int llint;

#define define_func_add(_t) _t add_##_t(_t a, _t b) { return a + b; }
#define define_func_sub(_t) _t sub_##_t(_t a, _t b) { return a - b; }
#define define_func_mul(_t) _t mul_##_t(_t a, _t b) { return a * b; }
#define define_func_div(_t) _t div_##_t(_t a, _t b) { return a / b; }
#define define_func_cov(_ta, _tb) _tb cov_#_ta#_#_tb(_ta x) { return x; }

define_func_add(int)
define_func_sub(int)
define_func_mul(int)
define_func_div(int)

define_func_add(lint)
define_func_sub(lint)
define_func_mul(lint)
define_func_div(lint)

define_func_add(llint)
define_func_sub(llint)
define_func_mul(llint)
define_func_div(llint)

define_func_cov(int, lint)
define_func_cov(int, llint)
define_func_cov(lint, int)
define_func_cov(lint, llint)
define_func_cov(llint, int)
define_func_cov(llint, lint)
```

类型描述文件（使用@描述空格，注意在CMS中，@是普通的标识符）：

```
.type int
    .size 4
    .func + add_int
    .func - sub_int
    .func * mul_int
    .func / div_int
    .func ->long@int cov_int_lint
    .func ->long@long@int cov_int_llint

.type long@int
    .size 4
    .func + add_lint
    .func - sub_lint
    .func * mul_lint
    .func / div_lint
    .func ->int cov_lint_int
    .func ->long@long@int cov_lint_llint

.type long@long@int
    .size 8
    .func + add_llint
    .func - sub_llint
    .func * mul_llint
    .func / div_llint
    .func ->int cov_llint_int
    .func ->long@int cov_llint_lint
```

## 使用

类型说明文件有两种，一种是内置的，一种是运行时的。

内置的类型说明文件会在构建新的CMS实现（如CVM）时参与编译，并加入到实现中，作为内置的类型使用。

外置的类型说明文件会在编译CMS代码时编译。
